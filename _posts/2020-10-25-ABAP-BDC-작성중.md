---
title: "ABAP BDC 작성중"
categories: 
  - ABAP
tags:
  - sap
  - abap
  - bdc
toc: true
---

## 1. Bulk Data Communication

약어로 BDC라고 불리며, 대량의 데이터를 유지보수 할 때 사용하는 standard 기능이다. Recording 기능으로 알려져 있다. 

- T-CODE: SHDB

예를 들어 자재마스터 정보를 변경 가능한 프로그램인 MM02에 접속해서 100개의 데이터를 수정해야 하는 상황이다. 하나씩 수정한다면 시간이 오래 걸림은 물론 실수의 가능성도 높아진다. 따라서 1 transaction(작업)을 반복해서 실행(standard 기준)하는 기능이다. 

![image](https://user-images.githubusercontent.com/58674365/97097966-ff6d1880-16ba-11eb-9f21-7a5709d39aa2.png)

![image](https://user-images.githubusercontent.com/58674365/97097971-1d3a7d80-16bb-11eb-8b73-e8678402e84c.png)

BDC는 transaction 동작을 기준으로 반복된다. 

![image](https://user-images.githubusercontent.com/58674365/97097975-2deaf380-16bb-11eb-9e6f-22c40c5e6629.png)
![image](https://user-images.githubusercontent.com/58674365/97097981-42c78700-16bb-11eb-971d-2edb2a03259c.png)
![image](https://user-images.githubusercontent.com/58674365/97097989-54109380-16bb-11eb-9532-68491bb607cb.png)
![image](https://user-images.githubusercontent.com/58674365/97097997-612d8280-16bb-11eb-8b85-fa5095174097.png)



스터디 알집 자료에 해당 자료가 있으니 확인하면 된다. 

BDC 프로그램에 엑셀 업로드라는 프로그램을 만들어 두었음

///

/nse93

```
*&---------------------------------------------------------------------*
*& Report ZBDC
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
REPORT zbdc.

*SHDB : Recording Overview
*BDC
DATA: ctu_params LIKE ctu_params,
      gt_bdc     LIKE TABLE OF bdcdata    WITH HEADER LINE,
      gt_msg     LIKE TABLE OF bdcmsgcoll WITH HEADER LINE.

PARAMETERS : p_dev   TYPE string,
             p_fname TYPE string,
             p_lname TYPE string.


*BDC 처리모드(dismode)
* A : 모든화면 조회
* E : 오류 조회
* N : 백그라운드 처리
* P : 백그라운드 처리: 디버깅 가능

ctu_params-dismode = 'A'.


*BDC Transcation Mode
*L : 로컬
*S : 동기
*A : 비동기

ctu_params-updmode = 'L'.


PERFORM bdc_append_data USING : 'X' 'SAPLSUID_MAINTENANCE' '1050',
                                ' ' 'BDC_OKCODE' '=CHAN',
                                ' ' 'SUID_ST_BNAME-BNAME'	p_dev.

PERFORM bdc_append_data USING : 'X' 'SAPLSUID_MAINTENANCE' '1100',
                                ' ' 'BDC_OKCODE' '/00',
                                ' ' 'SUID_ST_NODE_PERSON_NAME-NAME_LAST'  p_lname,
                                ' ' 'SUID_ST_NODE_PERSON_NAME-NAME_FIRST'  p_fname.



PERFORM bdc_append_data USING : 'X' 'SAPLSUID_MAINTENANCE' '1100',
                                ' ' 'BDC_OKCODE' '=UPD',
                                ' ' 'SUID_ST_NODE_PERSON_NAME-NAME_LAST'  p_lname,
                                ' ' 'SUID_ST_NODE_PERSON_NAME-NAME_FIRST'  p_fname.



CALL TRANSACTION 'SU01' USING gt_bdc
                        OPTIONS FROM ctu_params MESSAGES INTO gt_msg.


MESSAGE s000(zabap) WITH '정상적으로 처리 되었습니다.'.


*&---------------------------------------------------------------------*
*&      Form  BDC_APPEND_DATA
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
*      -->P_0010   text
*      -->P_0011   text
*      -->P_0012   text
*----------------------------------------------------------------------*
FORM bdc_append_data USING  p_dynbegin
                            p_name
                            p_value.

  CLEAR : gt_bdc.

  IF p_dynbegin = 'X'.
    gt_bdc-program  = p_name.
    gt_bdc-dynpro   = p_value.
    gt_bdc-dynbegin = p_dynbegin.
  ELSE.
    gt_bdc-fnam = p_name.
    gt_bdc-fval = p_value.
  ENDIF.

  APPEND gt_bdc.

ENDFORM.
```

비밀번호 일괄 변경 등 가능

생성된 것 shdb에서 확인 가능

//

lsmw 티코든 프로젝트 때 사용하는 대량 유지보수 프로그램

mm17 또한 마스터 데이터를 한번에 유지보수하는 프로그램

//

필드카탈로그

![image](https://user-images.githubusercontent.com/58674365/97098368-815f4080-16bf-11eb-9f65-b8e330f918de.png)
![image](https://user-images.githubusercontent.com/58674365/97098374-8ae8a880-16bf-11eb-90b7-6937c5695ec6.png)
![image](https://user-images.githubusercontent.com/58674365/97098381-a2279600-16bf-11eb-8cc4-b7aa4c91b47d.png)
![image](https://user-images.githubusercontent.com/58674365/97098386-abb0fe00-16bf-11eb-8d66-b34217de62b6.png)
![image](https://user-images.githubusercontent.com/58674365/97098394-b4a1cf80-16bf-11eb-9a3a-09fa9b1b430f.png)

마지막은 필드 카탈로그를 선언하지 않아도 자동으로 테이블 선언해서 만들도록 하는 부분, 필드 심볼 사용 부분

```
  METHOD lvc_field_catalog.

    clear : gt_fcat.

    CALL FUNCTION 'LVC_FIELDCATALOG_MERGE'
      EXPORTING
        i_structure_name       = i_db_table
*       I_INTERNAL_TABNAME     = l_table
      CHANGING
        ct_fieldcat            = gt_fcat
      EXCEPTIONS
        inconsistent_interface = 1
        program_error          = 2
        OTHERS                 = 3.


    IF sy-subrc EQ 0.

      e_field_catalog = gt_fcat.

    ENDIF.

  ENDMETHOD.
```

```


    CALL FUNCTION 'REUSE_ALV_FIELDCATALOG_MERGE'
      EXPORTING
        i_program_name         = sy-cprog
        i_internal_tabname     = i_internal_table
        i_inclname             = sy-cprog
      CHANGING
        ct_fieldcat            = gt_fieldcat
      EXCEPTIONS
        inconsistent_interface = 1
        program_error          = 2
        OTHERS                 = 3.

    IF sy-subrc EQ 0.

      CLEAR gs_fieldcat.

      LOOP AT gt_fieldcat INTO gs_fieldcat.

        gs_fcat-fieldname  = gs_fieldcat-fieldname.
        gs_fcat-col_pos    = gs_fieldcat-col_pos.
        gs_fcat-row_pos    = gs_fieldcat-row_pos.
        gs_fcat-ref_table  = gs_fieldcat-ref_tabname.
        gs_fcat-ref_field  = gs_fieldcat-ref_fieldname.
        gs_fcat-intlen     = gs_fieldcat-intlen.
        gs_fcat-inttype    = gs_fieldcat-inttype.
        gs_fcat-datatype   = gs_fieldcat-datatype.
        gs_fcat-checktable = gs_fieldcat-checkbox.
        gs_fcat-scrtext_l  = gs_fieldcat-seltext_l.
        gs_fcat-scrtext_s  = gs_fieldcat-seltext_s.
        gs_fcat-scrtext_m  = gs_fieldcat-seltext_m.

        APPEND gs_fcat TO gt_fcat.
      ENDLOOP.

      e_field_catalog = gt_fcat.
    ENDIF.







  ENDMETHOD.
```

```
  METHOD set_dynamic_internal_table.

*개발자가 입력한 Structure 기준으로 Dynamic Table을 구성한다.


    FIELD-SYMBOLS : <ft_table> TYPE ANY TABLE,
                    <fs_table> TYPE any.

    CALL METHOD cl_alv_table_create=>create_dynamic_table
      EXPORTING
        it_fieldcatalog = i_fieldcat
      IMPORTING
        ep_table        = et_table.


    ASSIGN et_table->* TO <ft_table>.

    CREATE DATA es_table LIKE LINE OF <ft_table>.
    ASSIGN es_table->* TO <fs_table>.


"여기까지가 internal table 발췌"


  ENDMETHOD.
```

- se24: 클래스가 어디서 어떻게 사용되는지 확인 가능







```
*&---------------------------------------------------------------------*
*& Report ZTEST
*&---------------------------------------------------------------------*
*& ver 1.0 2020.10.18
*&---------------------------------------------------------------------*
REPORT z_fcat_test.


DATA : lo_class TYPE REF TO zrapid_fcat.

*Header Line using Internal Table Definition.
DATA : BEGIN OF gt_header OCCURS 0.
    INCLUDE STRUCTURE sflight.
DATA : END OF gt_header.


DATA : gv_internal_table TYPE dd02l-tabname VALUE 'GT_HEADER',
       gv_db_table       TYPE dd02l-tabname VALUE 'SCARR'.

DATA : gt_fcat TYPE lvc_t_fcat.


START-OF-SELECTION.

*Field Catalog Rapid Class Instance.
  CREATE OBJECT lo_class.


*1.인터널 테이블 기준 발췌.
  lo_class->reuse_field_catalog(
  EXPORTING
    i_internal_table = gv_internal_table
  IMPORTING
    e_field_catalog = gt_fcat
  EXCEPTIONS
    OTHERS = 1 ).

*1.1. Field별 옵션 가공


*2.DB 테이블 기준 발췌.
  lo_class->lvc_field_catalog(
    EXPORTING
      i_db_table = gv_db_table
    IMPORTING
      e_field_catalog = gt_fcat
    EXCEPTIONS
      OTHERS = 1 ).
*2.1. Field별 옵션 가공


*3.인터널 테이블 자동생성(Create Dynamic Table Field)
*사전준비
*1.Field Symbol 변수 2, Data객체변수 2
*2.Field Catalog 인터널 테이블
*3.Coding Table 필드를 Field Symbol 인터널 테이블로 구성하기.(onGoing)
  FIELD-SYMBOLS : <fs_table> TYPE any,
                  <ft_table> TYPE ANY TABLE.

  DATA : ls_table TYPE REF TO data,
         lt_table TYPE REF TO data.

*Field Catalog 기준 인터널 테이블 동적 생성
  lo_class->set_dynamic_internal_table(
   EXPORTING
     i_fieldcat = gt_fcat
   IMPORTING
     es_table = ls_table
     et_table = lt_table
     ).

  IF sy-subrc EQ 0.
    ASSIGN ls_table->* TO <fs_table>. "Structure 생성
    ASSIGN lt_table->* TO <ft_table>. "Internal Table 생성
  ENDIF.
```

```

```

![image](https://user-images.githubusercontent.com/58674365/97098419-12361c00-16c0-11eb-94ce-ca0c2a7dd9a4.png)

